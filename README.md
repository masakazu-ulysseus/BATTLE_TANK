# TANK BATTLE - DEFEND YOUR BASE!

クラシックなタンクバトルゲーム。PythonとPyxelゲームエンジンで実装されています。

## 概要

タンクバトルは、戦車を操縦して敵戦車の波から自分の基地を守るレトロスタイルのアーケードゲームです。16の挑戦的なステージを攻略し、敵戦車を破壊し、パワーアップを収集して、何としても基地を守り抜きましょう。

## 特徴

- **クラシックなゲームプレイ**: 本格的なタンクバトルゲーム
- **16ステージ**: 段階的な難易度上昇と敵のスポーンシステム
- **4種類の敵戦車**: 異なる行動パターンと能力を持つ敵、インテリジェントなAI
- **パワーアップシステム**: 戦車の4段階アップグレード
- **6種類のアイテム**: ユニークな効果を持つ収集可能なパワーアップ
- **グリッドベース移動**: スムーズな16x16ピクセルグリッド移動システム
- **レトログラフィック**: ピクセルパーフェクトなスプライトベースレンダリング
- **ダイナミックサウンド**: プロシージャル効果音とBGM

## 動作環境

- Python 3.7以上
- Pyxel 2.5.1

## インストール

1. リポジトリをクローン:
```bash
git clone <repository-url>
cd BATTLE_TANK
```

2. 仮想環境を作成・アクティベート:
```bash
python -m venv .venv

# Windows
.venv\Scripts\activate

# macOS/Linux
source .venv/bin/activate
```

3. 依存関係をインストール:
```bash
pip install -r requirements.txt
```

## ゲーム実行

```bash
# 仮想環境アクティベート済みの場合
python main.py

# または直接実行
.venv/Scripts/python main.py  # Windows
.venv/bin/python main.py      # macOS/Linux
```

## 操作方法

- **矢印キー**: 戦車移動
- **スペースキー**: 弾丸発射
- **エンターキー**: ゲーム開始 / 画面進行
- **Qキー**: ゲーム終了

## ゲームプレイ

### 目的
各ステージの敵戦車20機をすべて破壊しながら、自分の基地を守りましょう。16ステージすべてをクリアするとゲームクリアです。

### 敵戦車の種類
- **軽戦車**: 基本的な敵、プレイヤーと基地を狙って攻撃 (体力1)
- **装甲戦車**: 高速移動、素早い動きでプレイヤーを追跡 (体力1)
- **速射戦車**: 高い連射能力、継続的な攻撃 (体力1)
- **重戦車**: 頑丈で戦略的な攻撃パターン (体力4、25%の確率でアイテム保持)

### パワーアップシステム
戦車は4段階にアップグレードできます:
1. **ノーマル**: 基本戦車
2. **速射**: 弾丸速度2倍
3. **2連射**: 同時に2発発射可能
4. **スーパー**: 鋼鉄壁も破壊可能

### アイテム
破壊された敵がドロップするアイテムを収集:
- **⭐ 星**: パワーレベルアップ
- **💣 手榴弾**: 画面上の全敵を破壊
- **🛡️ 戦車**: 残機追加
- **🛠️ シャベル**: 基地を一時的に鋼鉄で保護
- **⏰ 時計**: 全敵を一時停止
- **🎯 ヘルメット**: 一時的無敵

### 障害物システム

ゲームマップには以下の障害物があります：

#### 地形タイプ
- **🟫 レンガブロック**: 茶色の破壊可能な壁
  - すべての弾丸で破壊可能
  - 破壊されると通路になる
  - 戦車の移動を阻害

- **⬜ 鋼鉄ブロック**: 灰色の頑丈な壁  
  - スーパータンクの弾丸のみで破壊可能
  - 通常弾丸では破壊不可
  - 戦車の移動を完全阻害

- **🟦 水域**: 青色の水タイル
  - 戦車は通行不可
  - 弾丸は通過可能
  - 破壊不可能

- **🟩 森林**: 緑色の森エリア
  - 戦車は通過可能
  - 視覚的なカバーを提供
  - 破壊不可能

- **⬛ 通路**: 黒色の移動可能エリア
  - 戦車と弾丸が自由に通過
  - 障害物なし

- **🏠 司令部**: 黄色のプレイヤー基地
  - 破壊されるとゲームオーバー
  - 初期状態でレンガブロックに囲まれて保護されている
  - マップ下部中央に配置

#### 特殊効果
- **シャベルアイテム効果**: 司令部周囲が一時的に鋼鉄ブロックで保護される（10秒間）
- **効果終了後**: 元のタイル状態に復元（破壊されていた部分は破壊されたまま維持）

## 開発

### プロジェクト構造

```
BATTLE_TANK/
├── main.py              # ゲームエントリーポイント
├── game_manager.py      # ゲーム全体の制御とステートマシン
├── player.py           # プレイヤー戦車ロジック（日本語コメント）
├── enemy.py            # 敵AIと管理、インテリジェント攻撃システム
├── bullet.py           # 弾丸物理演算（日本語コメント）
├── collision.py        # 衝突判定
├── item.py             # パワーアップシステム
├── explosion.py        # 視覚効果
├── map_manager.py      # ステージと地形管理、Stage 1専用レイアウト
├── sound_manager.py    # オーディオシステム
├── game_context.py     # ゲームコンテキスト管理
├── constants.py        # ゲーム設定
├── my_resource.pyxres  # ゲームスプライトとリソース
└── README.md           # このファイル
```

### 主要アーキテクチャ

- **マネージャーパターン**: 敵、弾丸、アイテム、衝突の個別管理
- **コンポーネントシステム**: 関心の分離を重視したモジュール設計
- **グリッドベース物理**: 16x16タイルベースの移動と衝突
- **ステートマシン**: クリーンなゲーム状態遷移
- **リソースシステム**: スプライトとサウンドの一元管理

### ゲームリソースの編集

スプライトやサウンドを変更するには:
```bash
pyxel edit my_resource.pyxres
```

### 設定

ゲームバランスと設定は`constants.py`で変更可能:
- `ENEMIES_PER_STAGE`: ステージごとの敵数 (正式版: 20)
- `PLAYER_LIVES`: 初期残機数 (デフォルト: 3)
- `TANK_SPEED` / `BULLET_SPEED`: 移動速度と弾丸速度
- 敵スポーン間隔: 64フレーム (約1秒)
- ステージクリア表示時間: 120フレーム (2秒)
- その他の色とUI定数

## 技術仕様

- **エンジン**: Pyxel (Python レトロゲームエンジン)
- **解像度**: 256x240ピクセル
- **グリッドシステム**: 16x14タイル (各16px)
- **フレームレート**: 60 FPS
- **オーディオ**: プロシージャル音声合成
- **移動**: スムーズ補間グリッドベース移動

## ライセンス

このプロジェクトはオープンソースです。詳細はライセンスファイルをご確認ください。

## コントリビューション

1. リポジトリをフォーク
2. フィーチャーブランチを作成
3. 変更を実装
4. 必要に応じてテストを追加
5. プルリクエストを送信

## 最新の更新内容

### v1.0 公開版
- **著作権対応**: タイトルを「TANK BATTLE - DEFEND YOUR BASE!」に変更
- **コード日本語化**: player.py, bullet.pyのコメントを日本語に統一
- **敵AI強化**: プレイヤーと基地を積極的に狙う戦略的AI実装
- **UI改善**: タイトル画面のテキスト中央揃え
- **タイミング調整**: 敵スポーン間隔短縮、ステージクリア表示時間調整
- **Stage 1レイアウト**: ユーザー指定の精密なマップレイアウト実装

## 謝辞

- クラシックなタンクバトルゲームにインスパイア
- 優秀な[Pyxel](https://github.com/kitao/pyxel)ゲームエンジンで構築
- レトロゲーム慣例に従ったピクセルアートとゲームデザイン
