# TANK BATTLE - DEFEND YOUR BASE!

プロダクション品質のクラシックタンクバトルゲーム。PythonとPyxelゲームエンジンで実装されています。

## 概要

タンクバトルは、戦車を操縦して敵戦車の波から自分の基地を守るレトロスタイルのアーケードゲームです。16の挑戦的なステージを攻略し、敵戦車を破壊し、パワーアップを収集して、何としても基地を守り抜きましょう。

## 特徴

### ゲーム機能
- **クラシックなゲームプレイ**: 本格的なタンクバトルゲーム
- **16ステージ**: 段階的な難易度上昇と敵のスポーンシステム
- **4種類の敵戦車**: 異なる行動パターンと能力を持つ敵、インテリジェントなAI
- **パワーアップシステム**: 戦車の4段階アップグレード
- **6種類のアイテム**: ユニークな効果を持つ収集可能なパワーアップ
- **グリッドベース移動**: スムーズな16x16ピクセルグリッド移動システム
- **レトログラフィック**: ピクセルパーフェクトなスプライトベースレンダリング
- **ダイナミックサウンド**: プロシージャル効果音とBGM
- **マルチプラットフォーム対応**: PC、スマートフォン対応

### プロダクション品質の技術仕様
- **型安全性**: 100%型ヒント対応による堅牢なコードベース
- **エラーハンドリング**: 包括的な例外処理とグレースフルデグラデーション
- **パフォーマンス最適化**: 60FPS安定動作保証
- **アクセシビリティ**: キーボードとゲームパッド統合入力システム
- **保守性**: Component-Based Architectureと依存性注入パターン
- **拡張性**: 新機能追加に適した設計とアーキテクチャ

## 動作環境

- Python 3.7以上
- Pyxel 2.5.1

## インストール

1. リポジトリをクローン:
```bash
git clone <repository-url>
cd BATTLE_TANK
```

2. 仮想環境を作成・アクティベート:
```bash
python -m venv .venv

# Windows
.venv\Scripts\activate

# macOS/Linux
source .venv/bin/activate
```

3. 依存関係をインストール:
```bash
pip install -r requirements.txt
```

## ゲーム実行

```bash
# 仮想環境アクティベート済みの場合
python main.py

# または直接実行
.venv/Scripts/python main.py  # Windows
.venv/bin/python main.py      # macOS/Linux
```

## 操作方法

### キーボード操作
- **矢印キー**: 戦車移動
- **スペースキー**: 弾丸発射
- **エンターキー**: ゲーム開始 / 画面進行
- **Qキー**: ゲーム終了

### ゲームパッド操作（スマートフォン対応）
- **方向パッド**: 戦車移動
- **Aボタン**: 弾丸発射・メニュー操作
- **統合操作**: スマートフォンでの快適な操作性

### ブラウザ版での使用方法
ブラウザでゲームを実行する場合、スマートフォンでは画面下部にゲームパッドが自動表示されます。

#### ブラウザ版展開
```bash
# ローカルサーバーでテスト
python -m http.server 8000
# ブラウザで http://localhost:8000 にアクセス
```

#### ゲームパッド自動表示
- **PC**: キーボード操作
- **スマートフォン・タブレット**: 画面下部にタッチ操作ゲームパッド表示
- **統合操作**: デバイスに応じた最適な操作方法を自動選択

## ゲームプレイ

### 目的
各ステージの敵戦車20機をすべて破壊しながら、自分の基地を守りましょう。16ステージすべてをクリアするとゲームクリアです。

### 敵戦車の種類
- **軽戦車**: 基本的な敵、プレイヤーと基地を狙って攻撃 (体力1)
- **装甲戦車**: 高速移動、素早い動きでプレイヤーを追跡 (体力1)
- **速射戦車**: 高い連射能力、継続的な攻撃 (体力1)
- **重戦車**: 頑丈で戦略的な攻撃パターン (体力4、25%の確率でアイテム保持)

### パワーアップシステム
戦車は4段階にアップグレードできます:
1. **ノーマル**: 基本戦車
2. **速射**: 弾丸速度2倍
3. **2連射**: 同時に2発発射可能
4. **スーパー**: 鋼鉄壁も破壊可能

### アイテム
破壊された敵がドロップするアイテムを収集:
- **⭐ 星**: パワーレベルアップ
- **💣 手榴弾**: 画面上の全敵を破壊
- **🛡️ 戦車**: 残機追加
- **🛠️ シャベル**: 基地を一時的に鋼鉄で保護
- **⏰ 時計**: 全敵を一時停止
- **🎯 ヘルメット**: 一時的無敵

### 障害物システム

ゲームマップには以下の障害物があります：

#### 地形タイプ
- **🟫 レンガブロック**: 茶色の破壊可能な壁
  - すべての弾丸で破壊可能
  - 破壊されると通路になる
  - 戦車の移動を阻害

- **⬜ 鋼鉄ブロック**: 灰色の頑丈な壁  
  - スーパータンクの弾丸のみで破壊可能
  - 通常弾丸では破壊不可
  - 戦車の移動を完全阻害

- **🟦 水域**: 青色の水タイル
  - 戦車は通行不可
  - 弾丸は通過可能
  - 破壊不可能

- **🟩 森林**: 緑色の森エリア
  - 戦車は通過可能
  - 視覚的なカバーを提供
  - 破壊不可能

- **⬛ 通路**: 黒色の移動可能エリア
  - 戦車と弾丸が自由に通過
  - 障害物なし

- **🏠 司令部**: 黄色のプレイヤー基地
  - 破壊されるとゲームオーバー
  - 初期状態でレンガブロックに囲まれて保護されている
  - マップ下部中央に配置

#### 特殊効果
- **シャベルアイテム効果**: 司令部周囲が一時的に鋼鉄ブロックで保護される（10秒間）
- **効果終了後**: 元のタイル状態に復元（破壊されていた部分は破壊されたまま維持）

## 開発

### プロジェクト構造（プロダクション品質）

```
BATTLE_TANK/
├── main.py              # ゲームエントリーポイント（完全型注釈、エラーハンドリング）
├── game_manager.py      # 中央統制システム（1500行リファクタリング完了）
├── player.py           # プレイヤー戦車制御（高品質コード、ゲームパッド対応）
├── enemy.py            # 敵AIシステム（戦術的攻撃、最適化済み）
├── bullet.py           # 弾丸物理エンジン（パフォーマンス最適化済み）
├── collision.py        # 衝突検出システム（AABB最適化、責任分離）
├── item.py             # パワーアップシステム
├── explosion.py        # 視覚効果マネージャー
├── map_manager.py      # ステージ・地形管理システム
├── sound_manager.py    # オーディオエンジン
├── game_context.py     # 共有リソース管理
├── constants.py        # 設定体系（型安全、辞書ベース設定）
├── my_resource.pyxres  # ゲームスプライト・リソース
├── index.html          # ブラウザ版（ゲームパッド有効化済み）
└── README.md           # プロジェクト文書
```

### エンタープライズ級アーキテクチャ

#### 設計原則
- **Component-Based Architecture (CBA)**: 各システムの独立性と協調制御
- **依存性注入パターン**: システム間疎結合の実現
- **SOLID原則**: 単一責任、開放閉鎖、リスコフ置換、インターフェイス分離、依存性反転
- **エラー耐性設計**: グレースフルデグラデーション、フォールバック機能

#### 品質保証システム
- **100%型ヒント対応**: 全ファイル、全メソッドの型安全性
- **包括的エラーハンドリング**: try-except、フォールバック、デバッグ情報
- **パフォーマンス最適化**: 60FPS安定動作、メモリ効率化
- **日本語ドキュメント**: モジュール、クラス、メソッドレベルの完全文書化

#### システム統合
- **状態管理**: 辞書ベースディスパッチによる効率的状態遷移
- **リソース管理**: 一元化されたアセット・音響・エフェクト管理
- **入力システム**: キーボード・ゲームパッド統合、アクセシビリティ対応
- **レンダリング**: レイヤー構造による適切な視覚表現

### ゲームリソースの編集

スプライトやサウンドを変更するには:
```bash
pyxel edit my_resource.pyxres
```

### 設定システム（新機能）

ゲームバランスと設定は`constants.py`の新設定体系で管理:

#### 基本ゲーム設定
- `ENEMIES_PER_STAGE`: ステージごとの敵数 (現在: 10)
- `PLAYER_LIVES`: 初期残機数 (デフォルト: 3)
- `TANK_SPEED` / `BULLET_SPEED`: 移動速度と弾丸速度
- `ENEMY_SPAWN_INTERVAL`: 敵スポーン間隔 (64フレーム)

#### 新しい辞書ベース設定
- `ENEMY_HEALTH`: 敵タイプ別ヘルス設定
- `ENEMY_SCORE_VALUES`: 敵タイプ別スコア値
- `POWER_BULLET_LIMITS`: パワーレベル別弾丸制限
- `ITEM_EFFECT_DURATION`: アイテム効果時間設定
- `ENEMY_SPEED_MULTIPLIER`: 敵タイプ別速度倍率

#### UI・表示設定
- `TEXT_*`: 表示テキストテンプレート
- `UI_*`: ユーザーインターフェイス表示形式
- `COLOR_*`: カラーパレット定義
- `SPRITE_COORDS`: スプライト座標マッピング

#### デバッグ・開発設定
- `DEBUG_MODE`: デバッグ情報表示制御
- `COLLISION_DEBUG`: 衝突判定可視化
- `ENEMY_SPAWN_DEBUG`: 敵出現デバッグ情報

## 技術仕様

- **エンジン**: Pyxel (Python レトロゲームエンジン)
- **解像度**: 256x240ピクセル
- **グリッドシステム**: 16x14タイル (各16px)
- **フレームレート**: 60 FPS
- **オーディオ**: プロシージャル音声合成
- **移動**: スムーズ補間グリッドベース移動

## ライセンス

このプロジェクトはオープンソースです。詳細はライセンスファイルをご確認ください。

## コントリビューション

1. リポジトリをフォーク
2. フィーチャーブランチを作成
3. 変更を実装
4. 必要に応じてテストを追加
5. プルリクエストを送信

## 最新の更新内容

### v2.0 プロダクション品質版
- **大規模リファクタリング完了**: 全コードベースの品質向上
- **100%型ヒント対応**: 型安全性とIDE支援の実現
- **包括的エラーハンドリング**: 堅牢性とフォールバック機能
- **ゲームパッド対応**: スマートフォン・タブレット対応の統合入力システム
- **アーキテクチャ改善**: Component-Based設計と依存性注入
- **パフォーマンス最適化**: 60FPS安定動作とメモリ効率化
- **設定体系刷新**: 辞書ベース設定による柔軟なゲームバランス調整
- **日本語ドキュメント完備**: 全モジュール・クラス・メソッドの詳細文書化

### v1.0 公開版（ベースライン）
- **著作権対応**: タイトルを「TANK BATTLE - DEFEND YOUR BASE!」に変更
- **コード日本語化**: player.py, bullet.pyのコメントを日本語に統一
- **敵AI強化**: プレイヤーと基地を積極的に狙う戦略的AI実装
- **UI改善**: タイトル画面のテキスト中央揃え
- **タイミング調整**: 敵スポーン間隔短縮、ステージクリア表示時間調整
- **Stage 1レイアウト**: ユーザー指定の精密なマップレイアウト実装

## 謝辞

- クラシックなタンクバトルゲームにインスパイア
- 優秀な[Pyxel](https://github.com/kitao/pyxel)ゲームエンジンで構築
- レトロゲーム慣例に従ったピクセルアートとゲームデザイン
